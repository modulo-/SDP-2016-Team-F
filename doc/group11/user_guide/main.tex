\documentclass[a4paper,12pt]{scrartcl}
\usepackage{tabularx}
\usepackage[pdfusetitle, hidelinks]{hyperref}
\newcommand{\shellcmd}[1]{\indent\indent\texttt{\footnotesize\$ #1}}
\author{Thomas Kerber, Marek Strelec}
\title{User Guide}
\subtitle{Group 11}

\begin{document}
\maketitle
\section{Setup}
\subsection{requirements}

In order to run the computer side control program, the following python
packages need to be installed:

\begin{itemize}
\item \texttt{Polygon2}, for handling interactions of 2D polygons.
\item \texttt{pyserial}, for interacting with the serial RF device.
\item \texttt{numpy}, for various numerical calculations.
\item \texttt{openCV}, for vision processing.
\end{itemize}

On the university DiCE machines, \texttt{numpy} and \texttt{openCV} are already
preinstalled. To install the remaining packages, run the following commands:

\shellcmd{pip install --user Polygon2==2.0.6} \\
\shellcmd{pip install --user pyserial==2.7} \\

\subsection{Arduino}

The Arduino must be programmed with the robot's firmware before use. If this is
not already the case, it can be programmed by running the \texttt{arduino}
program, and opening the \texttt{/arduino/group11/group11.ino} sketch. If not
the case already, the sketchbook location should be set to \texttt{/arduino/},
to ensure that the libraries used are found. Next, the Arduino should be
connected to the computer, and the sketch compiled and uploaded to it using the
button for this purpose. The USB cable should then be removed. Finally, if the
robot was on during this process, it should be briefly switched off to allow
the Arduino serial device to reset.

\section{Usage}

Once ready to use, place a charged 8-pack of batteries in the back holder, and
connect it to the arduino power cable. Place 2 charges 4-packs of batteries in
the other two back holders, and attack the remaining power cables to them.
These two packs power the kicker.

Plug the RF stick in the computer, ensure top plates of all types, as well as
the ball, are on the pitch, and execute
`\texttt{./main -p <PLAN> -1 <PATH> -c <COLOR>}', there \texttt{<PLAN>} is the
plan to run (see section below), \texttt{<PATH>} is the device path of the RF
stick (e.g. `\verb$/dev/ttyACM0$'), and \texttt{<COLOR>} is the team color,
which must be one of `\texttt{blue}', `\texttt{b}', `\texttt{yellow}', or
`\texttt{y}' respectively. Further options notably include the `\texttt{-l}'
option, which sets the logging level. E.g. `\texttt{-l info}' enables info
messages in the logger.

\subsection{Calibration}

Before using the vision system, you can have a look at the vision feed by typing \emph{xawtv} in the command prompt. This will launch only the vision feed, where you can experiment with the different settings.

When the vision starts, it will enter calibration mode. In this mode, a still
of the pitch is displayed. In turn, red, blue, yellow, green, and pink will be
calibrated for. For each of these, click multiple times on parts of the still
which should be recognised as the specified color. When done with a color,
press `\texttt{q}' to move on to the next.

The calibrations will be saved locally, and can be loaded by pressing escape
when the calibration mode starts.

\subsection{Online Usage}

After the vision is lunched, there will be a window named \texttt{Filter} output, where you can see the vision feed with objects drawn on it representing the robots and the ball (if they are found).
Robots will be represented by an inner circle for the team colour (\texttt{yellow} or \texttt{blue}), an outer circle identifying which of the two team mates it is (\texttt{pink} or \texttt{green}) and an arrow giving the direction of the robot. The red ball is simply shown by drawing a red circle around it. You'll also notice two other windows containing several trackbars.
These trackbars are for filters that you can add to the output feed. There are filters to show only specific colours, or to different effects to the frame.

While the control program is running, the overall strategy and logging can be
modified. Entering `\texttt{debug}', `\texttt{info}', `\texttt{warn}', or
`\texttt{error}', and pressing enter, sets the logging level appropriately.
Likewise, entering a plan name and pressing enter switches the running plan to
what was entered. Entering `\texttt{stop}' unsets the active plan and leaves
the robot idle.

\pagebreak

\subsection{Plans}

A small number of plans are available to run:

\begin{itemize}
    \item `\texttt{move-grab}', to move to the ball and grab it.
    \item `\texttt{m1}', to do milestone 3, task 1.
    \item `\texttt{m2}', to do milestone 3, task 2.
    \item `\texttt{m31}', to do milestone 3, task 3.1.
    \item `\texttt{m32}', to do milestone 3, task 3.2.
\end{itemize}

% This is broken.
%\input{Vision}

\section{Troubleshooting}

Below are the actions to take for various common problems which may occur to
attempt to fix them.

\subsection{The Robot Doesn't Move}

If the robot is not moving, the first thing to do is to check the batteries.
Ensure that they are present, and charged. Next, disconnect the battery packs,
wait for a few seconds, then reconnect them.

\subsection{The Control Program Doesn't Start}

The control program not starting is likely due to the RF control signals
blocking. To test this, run the control program without the argument for the RF
stick. If it runs, then try waiting for five seconds, then re-running with the
normal arguments. If after a few attempts, this also does not work, then double
check the guard characters set on the RF stick. They should be three tilde
characters (`\verb$~~~$'). Use the proprietary CISCO tools located in the
`tools' folder to do this. If needed, reset the guard characters or change them
in the source.

\subsection{The Vision is Misdetecting Objects}

The vision misdetecting objects is likely due to miscalibration. Close the
controller, restart and recalibrate. Take care to select a wide range of colour
samples, including the fringes of the circles to detect.

\subsection{The Robot is Very Slow}

The batteries are low. Recharge or replace them.

\subsection{The Kicker Doesn't Work}

Check the connections between the two 4-packs of batteries, as well as the I/O
port kicker connection. Ensure that the kicker is pressed in, but has not
fallen out in the back. Check the battery level of the two 4-packs.

\end{document}
